<!DOCTYPE HTML>
<!-- ------------------------
		DO NOT EDIT
		MERGE CONTENTS INTO index.html AND THEN DELETE THIS FILE 
------------ -->


/*
 * Update the displayed LED state on the web page. This is called
 * periodically by the setInterval() callback as well as whenever
 * the on/off button callback returns.
 */
function update_led_state(which_led, val)
{
	if (which_led == "1"){
		var html = document.getElementById("led_state_onboard");
	} else if (which_led == "2"){
		var html = document.getElementById("led_state_1");
	} else if (which_led == "3"){
		var html = document.getElementById("led_state_2");
	}
	if (val == 0)
		html.innerHTML = "OFF";
	else if (val == 1)
		html.innerHTML = "ON";
	else
		html.innerHTML = "???";
}

/*
 * This function is called by the buttons when they are clicked.
 * If the button is pushed before the device global is assigned,
 * nothing will happen.
 */
function set_led(value)
{
	if (!device)
		return;

	device.callFunction("set_led", value, function(err,data) {
		if (err) return alert(err);
		console.log("SUCCESS: ", data);
		which_led = value[0];
		update_led_state(which_led, data.return_value);
	});
}

/*
 * Start a timer every 1 second to check the state of the LED,
 * but only if there is a currently selected device.
 */
setInterval(function() {
	if (!device)
		return;

	device.getVariable('led_state1', function(err,data) {
		if (err) return alert(err);
		which_led = 1;
		update_led_state(which_led, data.result);
	})
	device.getVariable('led_state2', function(err,data) {
		if (err) return alert(err);
		which_led = 2;
		update_led_state(which_led, data.result);
	})
	device.getVariable('led_state3', function(err,data) {
		if (err) return alert(err);
		which_led = 3;
		update_led_state(which_led, data.result);
	})

}, 1000);

</script>

</body>
</html>
	<button id="L1togglebutton" onclick="toggleL1()">Turn on LED 1</button>
	<button id="L2togglebutton" onclick="toggleL2()">Turn on LED 2</button>
	
	<br><br>
	<p>Current Time: <span id="time"></span><br>

	<script type="text/javascript">

	var funcName = "led";
	var getFunc = "time";

	buttonURL = "https://api.spark.io/v1/devices/" + deviceID + "/"+ funcName;

	function toggleL1(objButton) {
	
		$.post(buttonURL, {
			access_token: accessToken,
			params: "l1,HIGH",
		});
	}

	function toggleL2(objButton) {
	
		$.post(buttonURL, {
			access_token: accessToken,
			params: "l2,HIGH",
		});
	}

	window.setInterval(function() {
		timeURL = "https://api.spark.io/v1/devices/" + deviceID + "/" + getFunc + "/?access_token=" + accessToken;
		$.getJSON(timeURL, function(json){
 			//var time_as_int = parseInt(json.result) & 0xFFFFFFF;
 			//var time_as_int = parseInt(json.result);
 			var time_as_int = json.result;
			document.getElementById("time").innerHTML = time_as_int;

		});
	}, 1000);
	</script>
